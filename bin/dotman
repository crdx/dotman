#!/usr/bin/env ruby
require_relative '../lib/dotman'
include Dotman

class Main
    DOTFILE = 'Dotfile'

    def self.run(opts)
        unless File.exist?(DOTFILE)
            puts 'Dotfile not found'.red
            exit 1
        end

        class << Dotfile
            load DOTFILE
        end

        env = {
            base: File.expand_path(opts['--base']),
            home: File.expand_path(opts['--home'])
        }

        puts Dotfile.to_script(env)
    end
end

docs = <<~EOF
    #{'Usage:'.bold}
        dotman [options] build

    #{'Options:'.bold}
        --base=BASE         Dir from where symlinks should be sourced [default: ~/.dotfiles/files]
        --home=HOME         Dir where symlinks should be placed       [default: ~]
        -v, --version       Show version
        -h, --help          Show this help
EOF

begin
    Main.run(Docopt::docopt(docs, version: VERSION))
rescue Docopt::Exit => e
    puts e.message
    exit 1
end
